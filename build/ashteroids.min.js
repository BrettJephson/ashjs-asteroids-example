/**
 * almond 0.2.3 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 0.7.4 - Build: 252 (2012/02/24 10:30 PM)
 */

var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},15),n)},n.config=function(e){return u=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("lib/vendor/almond",function(){}),define("brejep/fillsnfixes",[],function(){function e(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout}function t(){window.Keyboard={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,CAPSLOCK:20,ESCAPE:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUMLOCK:144,SCROLL_LOCK:145,PAUSE_BREAK:19,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_ZERO:96,NUMPAD_ONE:97,NUMPAD_TWO:98,NUMPAD_THREE:99,NUMPAD_FOUR:100,NUMPAD_FIVE:101,NUMPAD_SIX:102,NUMPAD_SEVEN:103,NUMPAD_EIGHT:104,NUMPAD_NINE:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:13,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111}}var n={VERSION:"0.1.0",initialise:function(){e(),t()}};return n}),define("brejep/keypoll",[],function(){var e,t={},n=function(e){t[e.keyCode]=!0},r=function(e){t[e.keyCode]&&(t[e.keyCode]=!1)},i={VERSION:"0.1.0",initialise:function(t){e=t,e&&(e.addEventListener("keydown",n),e.addEventListener("keyup",r))},destroy:function(){e&&(e.removeEventListener("keydown",n),e.removeEventListener("keyup",r))},up:"38",down:"40",left:"37",right:"39",fire:"32",isDown:function(e){return t[e]}};return i}),function(e,t){var n=e.define,r,i,t;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var r=f[t];delete f[t],c[t]=!0,n.apply(e,r)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var n,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},n=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},r=i=s=function(t,r,i,a,f){return typeof t=="string"?u[t]?u[t](r):b(o(t,r).f):(t.splice||(l=t,r.splice?(t=r,r=i,i=null):t=e),r=r||function(){},typeof i=="function"&&(i=a,a=f),a?n(e,t,r,i):setTimeout(function(){n(e,t,r,i)},15),s)},s.config=function(e){return l=e,s},t=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},t.amd={jQuery:!0}})(),t("ash",[],"lib/vendor/almond",[],function(){}),t("brejep/class",[],function(){var e={extend:function(t){var n=this.prototype||e,r=Object.create(n);e.copyOwnTo(t,r);var i=r.constructor;if(i instanceof Function)return i.prototype=r,i.super=n,i.extend=this.extend,i;throw new Error("You must define a method 'constructor'")},copyOwnTo:function(e,t){return Object.getOwnPropertyNames(e).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}};return e}),t("ash-core/family",["brejep/class"],function(e){var t=e.extend({nodes:null,constructor:function(e,t){this.__defineGetter__("nodeList",function(){return this.nodes})},newEntity:function(e){throw new Error("should be overriden")},removeEntity:function(e){throw new Error("should be overriden")},componentAddedToEntity:function(e,t){throw new Error("should be overriden")},componentRemovedFromEntity:function(e,t){throw new Error("should be overriden")},cleanUp:function(){throw new Error("should be overriden")}});return t}),t("ash-core/nodepool",["brejep/class"],function(e){var t=e.extend({tail:null,cacheTail:null,nodeClass:null,constructor:function(e){this.nodeClass=e},get:function(){if(this.tail){var e=this.tail;return this.tail=this.tail.previous,e.previous=null,e}return new this.nodeClass},dispose:function(e){e.next=null,e.previous=this.tail,this.tail=e},cache:function(e){e.previous=this.cacheTail,this.cacheTail=e},releaseCache:function(){while(this.cacheTail){var e=this.cacheTail;this.cacheTail=e.previous,e.next=null,e.previous=this.tail,this.tail=e}}});return t}),function(e){function r(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function i(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}var n={VERSION:"0.7.4"};r.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},n.Signal=function(){this._bindings=[],this._prevParams=null},n.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,i){var s=this._indexOfListener(e,n),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o=new r(this,e,t,n,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,n){return i(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return i(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){i(e,"remove");var n=this._indexOfListener(e,t);return n!==-1&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},typeof t=="function"&&t.amd?t("signals",n):typeof module!="undefined"&&module.exports?module.exports=n:e.signals=n}(this),t("ash-core/nodelist",["signals","brejep/class"],function(e,t){var n=t.extend({constructor:function(){this.head=null,this.tail=null,this.nodeAdded=new e.Signal,this.nodeRemoved=new e.Signal},add:function(e){this.head?(this.tail.next=e,e.previous=this.tail,this.tail=e):this.head=this.tail=e,this.nodeAdded.dispatch(e)},remove:function(e){this.head==e&&(this.head=this.head.next),this.tail==e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous),this.nodeRemoved.dispatch(e)},removeAll:function(){while(this.head){var e=this.head;this.head=e.next,e.previous=null,e.next=null,this.nodeRemoved.dispatch(e)}this.tail=null},empty:function(){return this.head===null},swap:function(e,t){if(e.previous==t)e.previous=t.previous,t.previous=e,t.next=e.next,e.next=t;else if(t.previous==e)t.previous=e.previous,e.previous=t,e.next=t.next,t.next=e;else{var n=e.previous;e.previous=t.previous,t.previous=n,n=e.next,e.next=t.next,t.next=n}this.head==e?this.head=t:this.head==t&&(this.head=e),this.tail==e?this.tail=t:this.tail==t&&(this.tail=e),e.previous&&(e.previous.next=e),t.previous&&(t.previous.next=t),e.next&&(e.next.previous=e),t.next&&(t.next.previous=t)},insertionSort:function(e){if(this.head==this.tail)return;var t=this.head.next;for(var n=t;n;n=t){t=n.next;for(var r=n.previous;r;r=r.previous)if(e(n,r)>=0){n!=r.next&&(this.tail==n&&(this.tail=n.previous),n.previous.next=n.next,n.next&&(n.next.previous=n.previous),n.next=r.next,n.previous=r,n.next.previous=n,r.next=n);break}r||(this.tail==n&&(this.tail=n.previous),n.previous.next=n.next,n.next&&(n.next.previous=n.previous),n.next=this.head,this.head.previous=n,n.previous=null,this.head=n)}},mergeSort:function(e){if(this.head==this.tail)return;var t=[],n=this.head,r;while(n){r=n;while(r.next&&e(r,r.next)<=0)r=r.next;var i=r.next;n.previous=r.next=null,t.push(n),n=i}while(t.length>1)t.push(this.merge(t.shift(),t.shift(),e));this.tail=this.head=t[0];while(this.tail.next)this.tail=this.tail.next},merge:function(e,t,n){var r,i;n(e,t)<=0?(i=r=e,e=e.next):(i=r=t,t=t.next);while(e&&t)n(e,t)<=0?(r.next=e,e.previous=r,r=e,e=e.next):(r.next=t,t.previous=r,r=t,t=t.next);return e?(r.next=e,e.previous=r):(r.next=t,t.previous=r),i}});return n}),t("brejep/dictionary",["brejep/class"],function(e){var t=e.extend({VERSION:"0.1.0",keys:null,values:null,constructor:function(){return this.keys=[],this.values=[],this},add:function(e,t){var n=this.getIndex(e);n>=0?this.values[n]=t:(this.keys.push(e),this.values.push(t))},remove:function(e){var t=this.getIndex(e);if(!(t>=0))throw"Key does not exist";this.keys.splice(t,1),this.values.splice(t,1)},retrieve:function(e){var t=null,n=this.getIndex(e);return n>=0&&(t=this.values[n]),t},getIndex:function(e){var t=0,n=this.keys.length,r;for(;t<n;++t){r=this.keys[t];if(r==e)return t}return-1},has:function(e){var t=0,n=this.keys.length,r;for(;t<n;++t){r=this.keys[t];if(r==e)return!0}return!1},forEach:function(e){var t=0,n=this.keys.length,r,i;for(;t<n;++t){r=this.keys[t],i=this.values[t];var s=e(r,i);if(s==="return")return!1}return!0}});return t}),t("ash-core/componentmatchingfamily",["ash-core/family","ash-core/nodepool","ash-core/nodelist","brejep/dictionary"],function(e,t,n,r){var i=e.extend({constructor:function(e,i){this.nodeClass=e,this.engine=i,this.__defineGetter__("nodeList",function(){return this.nodes});var s=this.nodePool=new t(e);this.nodes=new n,this.entities=new r,this.components=new r,s.dispose(s.get());var o=e.prototype;for(var u in o)if(o.hasOwnProperty(u)&&u!="types"&&u!="next"&&u!="previous"&&u!="constructor"&&u!="super"&&u!="extend"&&u!="entity"){var a=o.types[u];this.components.add(a,u)}},newEntity:function(e){this.addIfMatch(e)},componentAddedToEntity:function(e,t){this.addIfMatch(e)},componentRemovedFromEntity:function(e,t){this.components.has(t)&&this.removeIfMatch(e)},removeEntity:function(e){this.removeIfMatch(e)},cleanUp:function(){for(var e=this.nodes.head;e;e=e.next)this.entities.remove(e.entity);this.nodes.removeAll()},addIfMatch:function(e){if(!this.entities.has(e)){var t;if(!this.components.forEach(function(t,n){if(!e.has(t))return"return"}))return;var n=this.nodePool.get();n.entity=e,this.components.forEach(function(t,r){n[r]=e.get(t)}),this.entities.add(e,n),e.componentRemoved.add(this.componentRemovedFromEntity,this),this.nodes.add(n)}},removeIfMatch:function(e){var t=this.entities,n=this.nodes,r=this.engine,i=this.nodePool;if(t.has(e)){var s=t.retrieve(e);e.componentRemoved.remove(this.componentRemovedFromEntity,this),t.remove(e),n.remove(s),r.updating?(i.cache(s),r.updateComplete.add(this.releaseNodePoolCache,this)):i.dispose(s)}},releaseNodePoolCache:function(){this.engine.updateComplete.remove(this.releaseNodePoolCache),this.nodePool.releaseCache()}});return i}),t("ash-core/entitylist",["brejep/class"],function(e){var t=e.extend({head:null,tail:null,constructor:function(){},add:function(e){this.head?(this.tail.next=e,e.previous=this.tail,this.tail=e):this.head=this.tail=e},remove:function(e){this.head==e&&(this.head=this.head.next),this.tail==e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous)},removeAll:function(){while(this.head){var e=this.head;this.head=this.head.next,e.previous=null,e.next=null}this.tail=null}});return t}),t("ash-core/systemlist",["brejep/class"],function(e){var t=e.extend({head:null,tail:null,constructor:function(){},add:function(e){if(!this.head)this.head=this.tail=e,e.next=e.previous=null;else{for(var t=this.tail;t;t=t.previous)if(t.priority<=e.priority)break;t===this.tail?(this.tail.next=e,e.previous=this.tail,e.next=null,this.tail=e):t?(e.next=t.next,e.previous=t,t.next.previous=e,t.next=e):(e.next=this.head,e.previous=null,this.head.previous=e,this.head=e)}},remove:function(e){this.head===e&&(this.head=this.head.next),this.tail===e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous)},removeAll:function(){while(this.head){var e=this.head;this.head=this.head.next,e.previous=null,e.next=null}this.tail=null},get:function(e){for(var t=this.head;t;t=t.next)if(t.is(e))return t;return null}});return t}),t("ash-core/engine",["ash-core/componentmatchingfamily","ash-core/entitylist","ash-core/systemlist","signals","brejep/dictionary","brejep/class"],function(e,t,n,r,i,s){var o=s.extend({familyClass:e,families:null,entityList:null,systemList:null,updating:!1,updateComplete:new r.Signal,constructor:function(){this.entityList=new t,this.systemList=new n,this.families=new i,this.__defineGetter__("entities",function(){var e=[];for(var t=this.entityList.head;t;t=t.next)e.push(t);return e}),this.__defineGetter__("systems",function(){var e=[];for(var t=this.systemList.head;t;t=t.next)e.push(t);return e})},addEntity:function(e){this.entityList.add(e),e.componentAdded.add(this.componentAdded,this),this.families.forEach(function(t,n){n.newEntity(e)})},removeEntity:function(e){e.componentAdded.remove(this.componentAdded,this),this.families.forEach(function(t,n){n.removeEntity(e)}),this.entityList.remove(e)},removeAllEntities:function(){while(this.entityList.head)this.removeEntity(this.entityList.head)},componentAdded:function(e,t){this.families.forEach(function(n,r){r.componentAddedToEntity(e,t)})},getNodeList:function(e){if(this.families.has(e))return this.families.retrieve(e).nodes;var t=new this.familyClass(e,this);this.families.add(e,t);for(var n=this.entityList.head;n;n=n.next)t.newEntity(n);return t.nodes},releaseNodeList:function(e){this.families.has(e)&&this.families.retrieve(e).cleanUp(),this.families.remove(e)},addSystem:function(e,t){e.priority=t,e.addToEngine(this),this.systemList.add(e)},getSystem:function(e){return this.systemList.get(e)},removeSystem:function(e){this.systemList.remove(e),e.removeFromEngine(this)},removeAllSystems:function(){while(this.systemList.head)this.removeSystem(this.systemList.head)},update:function(e){this.updating=!0;for(var t=this.systemList.head;t;t=t.next)t.update(e);this.updating=!1,this.updateComplete.dispatch()}});return o}),t("ash-core/entity",["signals","brejep/dictionary","brejep/class"],function(e,t,n){var r=n.extend({previous:null,next:null,components:null,constructor:function(){this.components=new t,this.componentAdded=new e.Signal,this.componentRemoved=new e.Signal},add:function(e,t){return t=t||e.constructor,t=t.prototype,this.components.has(t)&&this.remove(t),this.components.add(t,e),this.componentAdded.dispatch(this,t),this},remove:function(e){e=e.prototype;var t=this.components.retrieve(e);return t?(this.components.remove(e),this.componentRemoved.dispatch(this,e),t):null},get:function(e){return this.components.retrieve(e.prototype)},getAll:function(){var e=[];return this.components.forEach(function(t,n){e.push(n)}),e},has:function(e){return this.components.has(e.prototype)},clone:function(){var e=new r;return this.components.forEach(function(t,n){var r=new t.constructor;for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);e.add(r)}),e}});return r}),t("ash-core/node",["brejep/class"],function(e){var t=e.extend({entity:null,previous:null,next:null,constructor:function(){}});return t}),t("ash-core/system",["brejep/class"],function(e){var t=e.extend({previous:null,next:null,priority:0,constructor:function(){},addToEngine:function(e){},removeFromEngine:function(e){},update:function(e){},is:function(e){return e.prototype.isPrototypeOf(this)}});return t}),t("ash/ash-framework",["require","ash-core/engine","ash-core/componentmatchingfamily","ash-core/entity","ash-core/entitylist","ash-core/family","ash-core/node","ash-core/nodelist","ash-core/nodepool","ash-core/system","ash-core/systemlist","brejep/class","signals"],function(e){var t={VERSION:"0.1.0"};return t.Engine=e("ash-core/engine"),t.ComponentMatchingFamily=e("ash-core/componentmatchingfamily"),t.Entity=e("ash-core/entity"),t.EntityList=e("ash-core/entitylist"),t.Family=e("ash-core/family"),t.Node=e("ash-core/node"),t.NodeList=e("ash-core/nodelist"),t.NodePool=e("ash-core/nodepool"),t.System=e("ash-core/system"),t.SystemList=e("ash-core/systemlist"),t.Class=e("brejep/class"),t.Signals=e("signals"),t});var s=i("ash/ash-framework");typeof module!="undefined"&&module.exports?module.exports=s:n?function(e){e("ash",[],function(){return s})}(n):e.Ash=s}(this),define("game/components/gamestate",["ash"],function(e){var t=e.Class.extend({constructor:function(e,t){this.lives=0,this.level=0,this.points=0,this.width=e,this.height=t}});return t}),define("game/components/spaceship",["ash"],function(e){var t=e.Class.extend({constructor:function(){}});return t}),define("brejep/point",[],function(){var e=function(e,t){this.x=e||0,this.y=t||0};return e.VERSION="0.1.0",e.prototype.x=null,e.prototype.y=null,e.prototype.distanceSquaredTo=function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},e.prototype.distanceTo=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},e}),define("game/components/position",["ash","brejep/point"],function(e,t){var n=e.Class.extend({constructor:function(e,n,r,i){this.position=new t(e,n),this.rotation=r,this.collisionRadius=i}});return n}),define("game/nodes/spaceshipcollision",["ash","game/components/spaceship","game/components/position"],function(e,t,n){var r=e.Node.extend({spaceship:null,position:null,types:{spaceship:t,position:n},constructor:function(){}});return r}),define("game/components/asteroid",["ash"],function(e){var t=e.Class.extend({constructor:function(){}});return t}),define("game/nodes/asteroidcollision",["ash","game/components/asteroid","game/components/position"],function(e,t,n){var r=e.Node.extend({asteroid:null,position:null,types:{asteroid:t,position:n},constructor:function(){}});return r}),define("game/components/bullet",["ash"],function(e){var t=e.Class.extend({constructor:function(e){this.lifeRemaining=e}});return t}),define("game/nodes/bulletcollision",["ash","game/components/bullet","game/components/position"],function(e,t,n){var r=e.Node.extend({bullet:null,position:null,types:{bullet:t,position:n},constructor:function(){}});return r}),define("game/systems/gamemanager",["ash","game/nodes/spaceshipcollision","game/nodes/asteroidcollision","game/nodes/bulletcollision","brejep/point"],function(e,t,n,r,i){var s=e.System.extend({gameState:null,creator:null,spaceships:null,asteroids:null,bullets:null,constructor:function(e,t){this.gameState=e,this.creator=t},addToEngine:function(e){this.spaceships=e.getNodeList(t),this.asteroids=e.getNodeList(n),this.bullets=e.getNodeList(r)},update:function(e){if(this.spaceships.empty()&&this.gameState.lives>0){var t=new i(this.gameState.width*.5,this.gameState.height*.5),n=!0;for(var r=this.asteroids.head;r;r=r.next)if(r.position.position.distanceTo(t)<=r.position.collisionRadius+50){n=!1;break}n&&(this.creator.createSpaceship(),this.gameState.lives--)}if(this.asteroids.empty()&&this.bullets.empty()&&!this.spaceships.empty()){var s,o=this.spaceships.head;this.gameState.level++;var u=2+this.gameState.level;for(var a=0;a<u;++a){do s=new i(Math.random()*this.gameState.width,Math.random()*this.gameState.height);while(s.distanceTo(o.position.position)<=80);this.creator.createAsteroid(30,s.x,s.y)}}},removeFromEngine:function(e){this.spaceships=null,this.asteroids=null,this.bullets=null}});return s}),define("game/components/motioncontrols",["ash"],function(e){var t=e.Class.extend({constructor:function(e,t,n,r,i){this.left=e,this.right=t,this.accelerate=n,this.accelerationRate=r,this.rotationRate=i}});return t}),define("game/components/motion",["ash","brejep/point"],function(e,t){var n=e.Class.extend({constructor:function(e,n,r,i){this.velocity=new t(e,n),this.angularVelocity=r,this.damping=i}});return n}),define("game/nodes/motioncontrol",["ash","game/components/motioncontrols","game/components/position","game/components/motion"],function(e,t,n,r){var i=e.Node.extend({control:null,position:null,motion:null,types:{control:t,position:n,motion:r},constructor:function(){}});return i}),define("game/systems/motioncontrolsystem",["ash","game/nodes/motioncontrol"],function(e,t){var n=e.System.extend({keyPoll:null,nodeList:null,constructor:function(e){return this.keyPoll=e,this},addToEngine:function(e){this.nodeList=e.getNodeList(t)},removeFromEngine:function(e){this.nodeList=null},update:function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},updateNode:function(e,t){var n=e.control,r=e.position,i=e.motion;this.keyPoll.isDown(n.left)&&(r.rotation-=n.rotationRate*t),this.keyPoll.isDown(n.right)&&(r.rotation+=n.rotationRate*t),this.keyPoll.isDown(n.accelerate)&&(i.velocity.x+=Math.cos(r.rotation)*n.accelerationRate*t,i.velocity.y+=Math.sin(r.rotation)*n.accelerationRate*t)}});return n}),define("game/components/guncontrols",["ash"],function(e){var t=e.Class.extend({constructor:function(e){this.trigger=e}});return t}),define("game/components/gun",["ash","brejep/point"],function(e,t){var n=e.Class.extend({constructor:function(e,n,r,i){this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new t(e,n),this.minimumShotInterval=r,this.bulletLifetime=i}});return n}),define("game/nodes/guncontrol",["ash","game/components/guncontrols","game/components/gun","game/components/position"],function(e,t,n,r){var i=e.Node.extend({control:null,gun:null,position:null,types:{control:t,gun:n,position:r},constructor:function(){}});return i}),define("game/systems/guncontrolsystem",["ash","game/nodes/guncontrol"],function(e,t){var n=e.System.extend({keyPoll:null,creator:null,nodeList:null,constructor:function(e,t){this.keyPoll=e,this.creator=t},addToEngine:function(e){this.nodeList=e.getNodeList(t)},removeFromEngine:function(e){this.nodeList=null},update:function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},updateNode:function(e,t){var n=e.control,r=e.position,i=e.gun;i.shooting=this.keyPoll.isDown(n.trigger),i.timeSinceLastShot+=t,i.shooting&&i.timeSinceLastShot>=i.minimumShotInterval&&(this.creator.createUserBullet(i,r),i.timeSinceLastShot=0)}});return n}),define("game/nodes/bulletage",["ash","game/components/bullet"],function(e,t){var n=e.Node.extend({bullet:null,types:{bullet:t},constructor:function(){}});return n}),define("game/systems/bulletagesystem",["ash","game/nodes/bulletage"],function(e,t){var n=e.System.extend({creator:null,nodeList:null,constructor:function(e){this.creator=e},addToEngine:function(e){this.nodeList=e.getNodeList(t)},removeFromEngine:function(e){this.nodeList=null},update:function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},updateNode:function(e,t){var n=e.bullet;n.lifeRemaining-=t,n.lifeRemaining<=0&&this.creator.destroyEntity(e.entity)}});return n}),define("game/nodes/movement",["ash","game/components/position","game/components/motion"],function(e,t,n){var r=e.Node.extend({position:null,motion:null,types:{position:t,motion:n},constructor:function(){}});return r}),define("game/systems/movementsystem",["ash","game/nodes/movement"],function(e,t){var n=e.System.extend({gameState:null,nodeList:null,doAFewTimes:!0,constructor:function(e){return this.gameState=e,this},addToEngine:function(e){this.nodeList=e.getNodeList(t)},removeFromEngine:function(e){this.nodeList=null},update:function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},updateNode:function(e,t){var n=e.position,r=e.motion;n.position.x+=r.velocity.x*t,n.position.y+=r.velocity.y*t,n.position.x<0&&(n.position.x+=this.gameState.width),n.position.x>this.gameState.width&&(n.position.x-=this.gameState.width),n.position.y<0&&(n.position.y+=this.gameState.height),n.position.y>this.gameState.height&&(n.position.y-=this.gameState.height),n.rotation+=r.angularVelocity*t;if(r.damping>0){var i=Math.abs(Math.cos(n.rotation)*r.damping*t),s=Math.abs(Math.sin(n.rotation)*r.damping*t);r.velocity.x>i?r.velocity.x-=i:r.velocity.x<-i?r.velocity.x+=i:r.velocity.x=0,r.velocity.y>s?r.velocity.y-=s:r.velocity.y<-s?r.velocity.y+=s:r.velocity.y=0}}});return n}),define("game/systems/collisionsystem",["ash","game/nodes/spaceshipcollision","game/nodes/asteroidcollision","game/nodes/bulletcollision"],function(e,t,n,r){var i=e.System.extend({creator:null,spaceships:null,asteroids:null,bullets:null,constructor:function(e){return this.creator=e,this},addToEngine:function(e){this.spaceships=e.getNodeList(t),this.asteroids=e.getNodeList(n),this.bullets=e.getNodeList(r)},removeFromEngine:function(e){this.spaceships=null,this.asteroids=null,this.bullets=null},update:function(e){var t,n,r;for(t=this.bullets.head;t;t=t.next)for(n=this.asteroids.head;n;n=n.next)if(n.position.position.distanceTo(t.position.position)<=n.position.collisionRadius){this.creator.destroyEntity(t.entity),n.position.collisionRadius>10&&this.creator.createAsteroid(n.position.collisionRadius-10,n.position.position.x+Math.random()*10-5,n.position.position.y+Math.random()*10-5),this.creator.destroyEntity(n.entity);break}for(r=this.spaceships.head;r;r=r.next)for(n=this.asteroids.head;n;n=n.next)if(n.position.position.distanceTo(r.position.position)<=n.position.collisionRadius+r.position.collisionRadius){this.creator.destroyEntity(r.entity);break}}});return i}),define("game/components/display",["ash"],function(e){var t=e.Class.extend({constructor:function(e){this.graphic=e}});return t}),define("game/nodes/render",["ash","game/components/position","game/components/display"],function(e,t,n){var r=e.Node.extend({position:null,display:null,types:{position:t,display:n},constructor:function(){}});return r}),define("game/systems/rendersystem",["ash","game/nodes/render"],function(e,t){var n=e.System.extend({context:null,nodes:null,constructor:function(e){return this.context=e,this},addToEngine:function(e){this.nodes=e.getNodeList(t);for(var n=this.nodes.head;n;n=n.next)this.addToDisplay(n);this.nodes.nodeAdded.add(this.addToDisplay,this),this.nodes.nodeRemoved.add(this.removeFromDisplay,this)},removeFromEngine:function(e){this.nodes=null},addToDisplay:function(e){},removeFromDisplay:function(e){},update:function(e){var t,n,r,i;this.context.save(),this.context.translate(0,0),this.context.rotate(0),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);for(t=this.nodes.head;t;t=t.next)r=t.display,i=r.graphic,n=t.position,i.x=n.position.x,i.y=n.position.y,i.rotation=n.rotation,i.draw();this.context.restore()}});return n}),define("game/systems/systempriorities",[],function(){var e={preUpdate:1,update:2,move:3,resolveCollisions:4,render:5};return e}),define("game/graphics/asteroidview",[],function(){function e(e,t){this.initialise(e,t)}var t=e.prototype;return t.x=0,t.y=0,t.width=0,t.height=0,t.rotation=0,t.graphic=null,t.radius=0,t.points=null,t.initialise=function(e,t){this.graphic=t,this.radius=e,this.width=e,this.height=e,this.points=[];var n=0;while(n<Math.PI*2){var r=(.75+Math.random()*.25)*this.radius,i=Math.cos(n)*r,s=Math.sin(n)*r;this.points.push({x:i,y:s}),n+=Math.random()*.5}return this.draw(),this},t.count=0,t.draw=function(){var e=this.graphic;e.save(),e.beginPath(),e.translate(this.x,this.y),e.rotate(this.rotation),e.fillStyle="#FFFFFF",e.moveTo(this.radius,0);for(var t=0;t<this.points.length;++t)e.lineTo(this.points[t].x,this.points[t].y);e.lineTo(this.radius,0),e.fill(),e.restore()},e}),define("game/graphics/spaceshipview",[],function(){function e(e){this.initialise(e)}var t=e.prototype;return t.x=0,t.y=0,t.width=20,t.height=20,t.rotation=0,t.graphic=null,t.initialise=function(e){return this.graphic=e,this.draw(),this},t.draw=function(){var e=this.graphic;e.save(),e.beginPath(),e.translate(this.x,this.y),e.rotate(this.rotation),e.fillStyle="#FFFFFF",e.moveTo(8,0),e.lineTo(-7,7),e.lineTo(-4,0),e.lineTo(-7,-7),e.lineTo(10,0),e.fill(),e.restore()},e}),define("game/graphics/bulletview",[],function(){function e(e){this.initialise(e)}var t=e.prototype;return t.x=0,t.y=0,t.width=4,t.height=4,t.rotation=0,t.graphic=null,t.initialise=function(e){return this.graphic=e,this.draw(),this},t.draw=function(){var e=this.graphic;e.save(),e.rotate(this.rotation),e.beginPath(),e.fillStyle="#FFFFFF",e.arc(this.x,this.y,2,0,Math.PI*2,!1),e.fill(),e.restore()},e}),define("brejep/keyboard",[],function(){var e={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,CAPSLOCK:20,ESCAPE:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUMLOCK:144,SCROLL_LOCK:145,PAUSE_BREAK:19,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_ZERO:96,NUMPAD_ONE:97,NUMPAD_TWO:98,NUMPAD_THREE:99,NUMPAD_FOUR:100,NUMPAD_FIVE:101,NUMPAD_SIX:102,NUMPAD_SEVEN:103,NUMPAD_EIGHT:104,NUMPAD_NINE:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:13,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111};return e}),define("game/entitycreator",["ash","game/components/asteroid","game/components/spaceship","game/components/bullet","game/components/position","game/components/motion","game/components/motioncontrols","game/components/gun","game/components/guncontrols","game/components/display","game/graphics/asteroidview","game/graphics/spaceshipview","game/graphics/bulletview","brejep/keyboard"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=e.Class.extend({game:null,graphics:null,constructor:function(e,t){this.game=e,this.graphics=t},destroyEntity:function(e){this.game.removeEntity(e)},createAsteroid:function(n,r,o){var u=(new e.Entity).add(new t).add(new i(r,o,0,n)).add(new s((Math.random()-.5)*4*(50-n),(Math.random()-.5)*4*(50-n),Math.random()*2-1,0)).add(new f(new l(n,this.graphics)));return this.game.addEntity(u),u},createSpaceship:function(){var t=(new e.Entity).add(new n).add(new i(400,300,1,6)).add(new s(0,0,0,15)).add(new o(p.LEFT,p.RIGHT,p.UP,100,3)).add(new u(8,0,.3,2)).add(new a(p.Z)).add(new f(new c(this.graphics)));return this.game.addEntity(t),t},createUserBullet:function(t,n){var o=Math.cos(n.rotation),u=Math.sin(n.rotation),a=(new e.Entity).add(new r(t.bulletLifetime)).add(new i(o*t.offsetFromParent.x-u*t.offsetFromParent.y+n.position.x,u*t.offsetFromParent.x+o*t.offsetFromParent.y+n.position.y,0,0)).add(new s(o*150,u*150,0,0)).add(new f(new h(this.graphics)));return this.game.addEntity(a),a}});return d}),define("brejep/tickprovider",["ash"],function(e){var t=e.Class.extend({previousTime:0,ticked:new e.Signals.Signal,request:null,stats:null,constructor:function(e){this.stats=e},start:function(){this.request=requestAnimationFrame(this.tick.bind(this))},stop:function(){cancelRequestAnimationFrame(this.request)},add:function(e,t){this.ticked.add(e,t)},remove:function(e,t){this.ticked.remove(e,t)},tick:function(e){this.stats&&this.stats.begin(),e=e||Date.now();var t=this.previousTime||e;this.previousTime=e;var n=(e-t)*.001;this.ticked.dispatch(n),requestAnimationFrame(this.tick.bind(this)),this.stats&&this.stats.end()}});return t}),define("game/asteroids",["game/components/gamestate","game/systems/gamemanager","game/systems/motioncontrolsystem","game/systems/guncontrolsystem","game/systems/bulletagesystem","game/systems/movementsystem","game/systems/collisionsystem","game/systems/rendersystem","game/systems/systempriorities","game/entitycreator","ash","brejep/tickprovider","brejep/keypoll"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=l.Class.extend({width:0,height:0,engine:null,gameState:null,tickProvider:null,constructor:function(p,d){var v=p.getContext("2d");this.width=p.width,this.height=p.height,this.engine=new l.Engine,this.gameState=new e(this.width,this.height);var m=new f(this.engine,v);this.engine.addSystem(new t(this.gameState,m),a.preUpdate),this.engine.addSystem(new n(h),a.update),this.engine.addSystem(new r(h,m),a.update),this.engine.addSystem(new i(m),a.update),this.engine.addSystem(new s(this.gameState),a.move),this.engine.addSystem(new o(m),a.resolveCollisions),this.engine.addSystem(new u(v),a.render),this.tickProvider=new c(d)},start:function(){this.gameState.level=0,this.gameState.lives=3,this.gameState.points=0,this.tickProvider.add(this.engine.update,this.engine),this.tickProvider.start()}});return p});var Stats=function(){var e=Date.now(),t=e,n=0,r=Infinity,i=0,s=0,o=Infinity,u=0,a=0,f=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(e){e.preventDefault(),y(++f%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var c=document.createElement("div");c.id="fps",c.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(c);var h=document.createElement("div");h.id="fpsText",h.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",h.innerHTML="FPS",c.appendChild(h);var p=document.createElement("div");p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(c.appendChild(p);74>p.children.length;){var d=document.createElement("span");d.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(d)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var m=document.createElement("div");m.id="msText",m.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="MS",v.appendChild(m);var g=document.createElement("div");g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(v.appendChild(g);74>g.children.length;)d=document.createElement("span"),d.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(d);var y=function(e){f=e;switch(f){case 0:c.style.display="block",v.style.display="none";break;case 1:c.style.display="none",v.style.display="block"}};return{REVISION:11,domElement:l,setMode:y,begin:function(){e=Date.now()},end:function(){var f=Date.now();n=f-e,r=Math.min(r,n),i=Math.max(i,n),m.textContent=n+" MS ("+r+"-"+i+")";var l=Math.min(30,30-30*(n/200));return g.appendChild(g.firstChild).style.height=l+"px",a++,f>t+1e3&&(s=Math.round(1e3*a/(f-t)),o=Math.min(o,s),u=Math.max(u,s),h.textContent=s+" FPS ("+o+"-"+u+")",l=Math.min(30,30-30*(s/100)),p.appendChild(p.firstChild).style.height=l+"px",t=f,a=0),f},update:function(){e=this.end()}}};define("Stats",function(e){return function(){var t,n;return t||e.Stats}}(this)),require(["brejep/fillsnfixes","brejep/keypoll","game/asteroids","Stats"],function(e,t,n,r){function i(){function o(){var e=document.createElement("canvas");return e.setAttribute("id","game_stage"),e.setAttribute("width",i),e.setAttribute("height",s),e.style.backgroundColor="#000",e}var i=800,s=600;this.initialise=function(){e.initialise();var i=o(),s=document.getElementById("game-wrapper");s.appendChild(i),t.initialise(window);var u=new r;u.setMode(0),u.domElement.style.position="absolute",u.domElement.style.left="0px",u.domElement.style.top="0px",s.appendChild(u.domElement);var a=new n(i,u);a.start()}}(new i).initialise()}),define("src/asteroids-app",function(){});