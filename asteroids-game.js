/**
 * almond 0.2.3 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 0.7.4 - Build: 252 (2012/02/24 10:30 PM)
 */

/*

 JS Signals <http://millermedeiros.github.com/js-signals/>
 Released under the MIT license
 Author: Miller Medeiros
 Version: 0.7.4 - Build: 252 (2012/02/24 10:30 PM)
*/

var requirejs,require,define;(function(e){function t(e,t){return g.call(e,t)}function n(e,t){var n,r,i,s,o,u,a,f,l,c,h=t&&t.split("/"),p=v.map,d=p&&p["*"]||{};if(e&&e.charAt(0)===".")if(t){h=h.slice(0,h.length-1),e=h.concat(e.split("/"));for(f=0;f<e.length;f+=1){c=e[f];if(c===".")e.splice(f,1),f-=1;else if(c===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((h||d)&&p){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(h)for(l=h.length;l>0;l-=1){i=p[h.slice(0,l).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&d&&d[r]&&(u=d[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function r(t,n){return function(){return l.apply(e,y.call(arguments,0).concat([t,n]))}}function i(e){return function(t){return n(t,e)}}function s(e){return function(t){p[e]=t}}function o(n){if(t(d,n)){var r=d[n];delete d[n],m[n]=!0,f.apply(e,r)}if(!t(p,n)&&!t(m,n))throw new Error("No "+n);return p[n]}function u(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function a(e){return function(){return v&&v.config&&v.config[e]||{}}}var f,l,c,h,p={},d={},v={},m={},g=Object.prototype.hasOwnProperty,y=[].slice;c=function(e,t){var r,s=u(e),a=s[0];return e=s[1],a&&(a=n(a,t),r=o(a)),a?r&&r.normalize?e=r.normalize(e,i(t)):e=n(e,t):(e=n(e,t),s=u(e),a=s[0],e=s[1],a&&(r=o(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:r}},h={require:function(e){return r(e)},exports:function(e){var t=p[e];return typeof t!="undefined"?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:a(e)}}},f=function(n,i,u,a){var f,l,v,g,y,b=[],w;a=a||n;if(typeof u=="function"){i=!i.length&&u.length?["require","exports","module"]:i;for(y=0;y<i.length;y+=1){g=c(i[y],a),l=g.f;if(l==="require")b[y]=h.require(n);else if(l==="exports")b[y]=h.exports(n),w=!0;else if(l==="module")f=b[y]=h.module(n);else if(t(p,l)||t(d,l)||t(m,l))b[y]=o(l);else{if(!g.p)throw new Error(n+" missing "+l);g.p.load(g.n,r(a,!0),s(l),{}),b[y]=p[l]}}v=u.apply(p[n],b);if(n)if(f&&f.exports!==e&&f.exports!==p[n])p[n]=f.exports;else if(v!==e||!w)p[n]=v}else n&&(p[n]=u)},requirejs=require=l=function(t,n,r,i,s){return typeof t=="string"?h[t]?h[t](n):o(c(t,n).f):(t.splice||(v=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=i,i=s),i?f(e,t,n,r):setTimeout(function(){f(e,t,n,r)},15),l)},l.config=function(e){return v=e,l},define=function(e,n,r){n.splice||(r=n,n=[]),!t(p,e)&&!t(d,e)&&(d[e]=[e,n,r])},define.amd={jQuery:!0}})(),define("almond",function(){}),function(e){function t(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function n(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}var r={VERSION:"0.7.4"};t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.Signal=function(){this._bindings=[],this._prevParams=null},r.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,r,i){var s=this._indexOfListener(e,r),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,e,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return r!==-1&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},typeof define=="function"&&define.amd?define("libs/signals",r):typeof module!="undefined"&&module.exports?module.exports=r:e.signals=r}(this),function(e){function t(){typeof Object.create!="function"&&(Object.create=function(e){function t(){}return t.prototype=e,new t})}function n(){typeof Object.extend!="function"&&(Object.extend=function(e,t){for(var n in t)!e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(e[n]=t[n]);return e})}function r(){typeof Object.deepExtend!="function"&&(Object.deepExtend=function(e,t){for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},arguments.callee(e[n],t[n])):e[n]=t[n];return e})}function i(){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(t,n){return e.setTimeout(t,1e3/60)};e.requestAnimationFrame=t;var n=e.cancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||e.clearTimeout;e.cancelRequestAnimationFrame=n}function s(){e.Keyboard={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,CAPSLOCK:20,ESCAPE:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUMLOCK:144,SCROLL_LOCK:145,PAUSE_BREAK:19,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_ZERO:96,NUMPAD_ONE:97,NUMPAD_TWO:98,NUMPAD_THREE:99,NUMPAD_FOUR:100,NUMPAD_FIVE:101,NUMPAD_SIX:102,NUMPAD_SEVEN:103,NUMPAD_EIGHT:104,NUMPAD_NINE:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:13,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111}}function o(){function e(e,t){var n=t.length;for(var r=0;r<e.length;++r)for(var i=0;i<t.length;++i)e[r]==t[i]&&n--;return n===0}window.hasItems=e}e.TEST_ENV=0,e.STAGE_ENV=1,e.LIVE_ENV=2;var u={VERSION:"0.1.0",initialise:function(e){t(),n(),r(),i(),s(),e==TEST_ENV&&o()}};typeof define=="function"&&define.amd?define("brejep/fillsnfixes",u):typeof module!="undefined"&&module.exports?module.exports=u:e.fillsnfixes=u}(this),define("brejep/fillsnfixes",function(){}),function(e,t){typeof define=="function"&&define.amd?define("brejep/dictionary",t):(typeof e.brejep=="undefined"&&(e.brejep={}),e.brejep.dictionary=t())}(this,function(){function e(){this.initialise()}var t=e.prototype;return t.VERSION="0.1.0",t.keys=null,t.values=null,t.initialise=function(){return this.keys=[],this.values=[],this},t.add=function(e,t){var n=this.getIndex(e);n>=0?this.values[n]=t:(this.keys.push(e),this.values.push(t))},t.remove=function(e){var t=this.getIndex(e);if(!(t>=0))throw"Key does not exist";this.keys.splice(t,1),this.values.splice(t,1)},t.retrieve=function(e){var t=null,n=this.getIndex(e);return n>=0&&(t=this.values[n]),t},t.getIndex=function(e){var t=0,n=this.keys.length,r;for(;t<n;++t){r=this.keys[t];if(r==e)return t}return-1},t.has=function(e){var t=0,n=this.keys.length,r;for(;t<n;++t){r=this.keys[t];if(r==e)return!0}return!1},t.forEach=function(e){var t=0,n=this.keys.length,r,i;for(;t<n;++t){r=this.keys[t],i=this.values[t];var s=e(r,i);if(s=="return")return!1}return!0},e}),define("brejep/dictionary",function(){}),function(e,t){typeof define=="function"&&define.amd?define("brejep/point",t):(typeof e.brejep=="undefined"&&(e.brejep={}),e.brejep.point=t())}(this,function(){function e(e,t){this.x=e||0,this.y=t||0}return e.VERSION="0.1.0",e.prototype.x=null,e.prototype.y=null,e.prototype.distanceSquaredTo=function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},e.prototype.distanceTo=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},e}),define("brejep/point",function(){}),function(e,t){typeof define=="function"&&define.amd?define("ash/entity",["libs/signals","brejep/dictionary"],t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.entity=t(e.signals,e.brejep.dictionary))}(this,function(e,t){function n(){this.initialise()}var r=n.prototype;return r.componentAdded=new e.Signal,r.componentRemoved=new e.Signal,r.previous=null,r.next=null,r.components=null,r.initialise=function(){return this.components=new t,this},r.add=function(e,t){return t=t||e.constructor,t=t.prototype,this.components.has(t)&&this.remove(t),this.components.add(t,e),this.componentAdded.dispatch(this,t),this},r.remove=function(e){e=e.prototype;var t=this.components.retrieve(e);return t?(this.components.remove(e),this.componentRemoved.dispatch(this,e),t):null},r.get=function(e){return this.components.retrieve(e.prototype)},r.getAll=function(){var e=[];return this.components.forEach(function(t,n){e.push(n)}),e},r.has=function(e){return this.components.has(e.prototype)},r.clone=function(){var e=new n;return this.components.forEach(function(t,n){var r=new t.constructor;for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);e.add(r)}),e},n}),function(e,t){typeof define=="function"&&define.amd?define("ash/entitylist",t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.entitylist=t())}(this,function(){function e(){}var t=e.prototype;return t.head=null,t.tail=null,t.add=function(e){this.head?(this.tail.next=e,e.previous=this.tail,this.tail=e):this.head=this.tail=e},t.remove=function(e){this.head==e&&(this.head=this.head.next),this.tail==e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous)},t.removeAll=function(){while(this.head){var e=this.head;this.head=this.head.next,e.previous=null,e.next=null}this.tail=null},e}),define("ash/entitylist",function(){}),function(e,t){typeof define=="function"&&define.amd?define("ash/node",t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.node=t())}(this,function(){function e(){}var t=e.prototype;return t.entity=null,t.previous=null,t.next=null,e}),define("ash/node",function(){}),function(e,t){typeof define=="function"&&define.amd?define("ash/nodelist",["libs/signals"],t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.nodelist=t(e.signals))}(this,function(e){function t(){}return t.prototype.head=null,t.prototype.tail=null,t.prototype.nodeAdded=new e.Signal,t.prototype.nodeRemoved=new e.Signal,t.prototype.add=function(e){this.head?(this.tail.next=e,e.previous=this.tail,this.tail=e):this.head=this.tail=e,this.nodeAdded.dispatch(e)},t.prototype.remove=function(e){this.head==e&&(this.head=this.head.next),this.tail==e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous),this.nodeRemoved.dispatch(e)},t.prototype.removeAll=function(){while(this.head){var e=this.head;this.head=e.next,e.previous=null,e.next=null,this.nodeRemoved.dispatch(e)}this.tail=null},t.prototype.empty=function(){return this.head==null},t.prototype.swap=function(e,t){if(e.previous==t)e.previous=t.previous,t.previous=e,t.next=e.next,e.next=t;else if(t.previous==e)t.previous=e.previous,e.previous=t,e.next=t.next,t.next=e;else{var n=e.previous;e.previous=t.previous,t.previous=n,n=e.next,e.next=t.next,t.next=n}this.head==e?this.head=t:this.head==t&&(this.head=e),this.tail==e?this.tail=t:this.tail==t&&(this.tail=e),e.previous&&(e.previous.next=e),t.previous&&(t.previous.next=t),e.next&&(e.next.previous=e),t.next&&(t.next.previous=t)},t}),function(e,t){typeof define=="function"&&define.amd?define("ash/nodepool",t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.nodepool=t())}(this,function(){function e(e){this.initialise(e)}var t=e.prototype;return t.tail=null,t.cacheTail=null,t.nodeClass=null,t.initialise=function(e){return this.nodeClass=e,this},t.get=function(){if(this.tail){var e=this.tail;return this.tail=this.tail.previous,e.previous=null,e}return new this.nodeClass},t.dispose=function(e){e.next=null,e.previous=this.tail,this.tail=e},t.cache=function(e){e.previous=this.cacheTail,this.cacheTail=e},t.releaseCache=function(){while(this.cacheTail){var e=this.cacheTail;this.cacheTail=e.previous,e.next=null,e.previous=this.tail,this.tail=e}},e}),define("ash/nodepool",function(){}),function(e,t){typeof define=="function"&&define.amd?define("ash/family",[],t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.family=t())}(this,function(){function e(){}return e.prototype.nodes=null,e.prototype.__defineGetter__("nodeList",function(){return this.nodes}),e.prototype.initialise=function(e,t){throw new Error("should be overriden")},e.prototype.newEntity=function(e){throw new Error("should be overriden")},e.prototype.removeEntity=function(e){throw new Error("should be overriden")},e.prototype.componentAddedToEntity=function(e,t){throw new Error("should be overriden")},e.prototype.componentRemovedFromEntity=function(e,t){throw new Error("should be overriden")},e.prototype.cleanUp=function(){throw new Error("should be overriden")},e}),function(e,t){typeof define=="function"&&define.amd?define("ash/componentmatchingfamily",["ash/family","ash/nodepool","ash/nodelist","brejep/dictionary"],t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.componentmatchingfamily=t(e.ash.family,e.ash.nodepool,e.ash.nodelist,e.brejep.dictionary))}(this,function(e,t,n,r){function i(t,n){Object.extend(i.prototype,e.prototype),this.nodeClass=t,this.engine=n,this.initialise()}var s=i.prototype;return s.nodeClass=null,s.engine=null,s.nodes=null,s.entities=null,s.components=null,s.nodePool=null,s.__defineGetter__("nodeList",function(){return this.nodes}),s.initialise=function(){var e=this.nodeClass,i=this.nodePool=new t(e);this.nodes=new n,this.entities=new r,this.components=new r,i.dispose(i.get());var s=e.prototype;for(var o in s)if(s.hasOwnProperty(o)&&o!="types"&&o!="next"&&o!="previous"&&o!="entity"){var u=s.types[o];this.components.add(u,o)}return this},s.newEntity=function(e){this.addIfMatch(e)},s.componentAddedToEntity=function(e,t){this.addIfMatch(e)},s.componentRemovedFromEntity=function(e,t){this.components.has(t)&&this.removeIfMatch(e)},s.removeEntity=function(e){this.removeIfMatch(e)},s.cleanUp=function(){for(var e=this.nodes.head;e;e=e.next)delete this.entities.retrieve(e.entity);this.nodes.removeAll()},s.addIfMatch=function(e){if(!this.entities.has(e)){var t;if(!this.components.forEach(function(t,n){if(!e.has(t))return"return"}))return;var n=this.nodePool.get();n.entity=e,this.components.forEach(function(t,r){n[r]=e.get(t)}),this.entities.add(e,n),e.componentRemoved.add(this.componentRemovedFromEntity,this),this.nodes.add(n)}},s.removeIfMatch=function(e){var t=this.entities,n=this.nodes,r=this.engine,i=this.nodePool;if(t.has(e)){var s=t.retrieve(e);e.componentRemoved.remove(this.componentRemovedFromEntity,this),t.remove(e),n.remove(s),r.updating?(i.cache(s),r.updateComplete.add(this.releaseNodePoolCache,this)):i.dispose(s)}},s.releaseNodePoolCache=function(){this.engine.updateComplete.remove(this.releaseNodePoolCache),this.nodePool.releaseCache()},i}),function(e,t){typeof define=="function"&&define.amd?define("ash/system",t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.system=t())}(this,function(){function e(){}return e.prototype.previous=null,e.prototype.next=null,e.prototype.priority=0,e.prototype.initialise=function(){return this},e.prototype.addToEngine=function(e){},e.prototype.removeFromEngine=function(e){},e.prototype.update=function(e){},e.prototype.is=function(e){return e.prototype.isPrototypeOf(this)},e}),define("ash/system",function(){}),function(e,t){typeof define=="function"&&define.amd?define("ash/systemlist",t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.systemlist=t())}(this,function(){function e(){}var t=e.prototype;return t.head=null,t.tail=null,t.add=function(e){if(!this.head)this.head=this.tail=e,e.next=e.previous=null;else{for(var t=this.tail;t;t=t.previous)if(t.priority<=e.priority)break;t==this.tail?(this.tail.next=e,e.previous=this.tail,e.next=null,this.tail=e):t?(e.next=t.next,e.previous=t,t.next.previous=e,t.next=e):(e.next=this.head,e.previous=null,this.head.previous=e,this.head=e)}},t.remove=function(e){this.head==e&&(this.head=this.head.next),this.tail==e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous)},t.removeAll=function(){while(this.head){var e=this.head;this.head=this.head.next,e.previous=null,e.next=null}this.tail=null},t.get=function(e){for(var t=this.head;t;t=t.next)if(t.is(e))return t;return null},e}),define("ash/systemlist",function(){}),function(e,t){typeof define=="function"&&define.amd?define("ash/engine",["ash/componentmatchingfamily","ash/entitylist","ash/systemlist","libs/signals","brejep/dictionary"],t):(typeof e.ash=="undefined"&&(e.ash={}),e.ash.engine=t(e.ash.componentmatchingfamily,e.ash.entitylist,e.ash.systemlist,e.signals,e.brejep.dictionary))}(this,function(e,t,n,r,i){function s(){this.initialise()}var o=s.prototype;return o.initialise=function(){return this.entityList=new t,this.systemList=new n,this.families=new i,this.__defineGetter__("entities",function(){var e=[];for(var t=this.entityList.head;t;t=t.next)e.push(t);return e}),this.__defineGetter__("systems",function(){var e=[];for(var t=this.systemList.head;t;t=t.next)e.push(t);return e}),this},o.familyClass=e,o.families=null,o.entityList=null,o.systemList=null,o.updating=!1,o.updateComplete=new r.Signal,o.addEntity=function(e){this.entityList.add(e),e.componentAdded.add(this.componentAdded,this),this.families.forEach(function(t,n){n.newEntity(e)})},o.removeEntity=function(e){e.componentAdded.remove(this.componentAdded,this),this.families.forEach(function(t,n){n.removeEntity(e)}),this.entityList.remove(e)},o.removeAllEntities=function(){while(this.entityList.head)this.removeEntity(this.entityList.head)},o.componentAdded=function(e,t){this.families.forEach(function(n,r){r.componentAddedToEntity(e,t)})},o.getNodeList=function(e){if(this.families.has(e))return this.families.retrieve(e).nodes;var t=new this.familyClass(e,this);this.families.add(e,t);for(var n=this.entityList.head;n;n=n.next)t.newEntity(n);return t.nodes},o.releaseNodeList=function(e){this.families.has(e)&&this.families.retrieve(e).cleanUp(),this.families.remove(e)},o.addSystem=function(e,t){e.priority=t,e.addToEngine(this),this.systemList.add(e)},o.getSystem=function(e){return this.systemList.get(e)},o.removeSystem=function(e){this.systemList.remove(e),e.removeFromEngine(this)},o.removeAllSystems=function(){while(this.systemList.head)this.removeSystem(this.systemList.head)},o.update=function(e){this.updating=!0;for(var t=this.systemList.head;t;t=t.next)t.update(e);this.updating=!1,this.updateComplete.dispatch()},s}),require(["require"],function(e){e(["almond","libs/signals","brejep/fillsnfixes","brejep/dictionary","brejep/point","ash/entity","ash/entitylist","ash/node","ash/nodelist","ash/nodepool","ash/family","ash/componentmatchingfamily","ash/system","ash/systemlist","ash/engine"])}),define("build/ash-build",function(){}),define("libs/ash",function(){}),function(e,t){typeof define=="function"&&define.amd?define("brejep/keypoll",t):(typeof e.brejep=="undefined"&&(e.brejep={}),e.brejep.keypoll=t())}(this,function(){function t(){function r(e){e.preventDefault(),n[e.keyCode]=!0}function i(e){e.preventDefault(),n[e.keyCode]&&(n[e.keyCode]=null,delete n[e.keyCode])}function s(){e.addEventListener("keydown",r),e.addEventListener("keyup",i)}t.VERSION="0.1.0";var n={};s(),this.up="38",this.down="40",this.left="37",this.right="39",this.fire="32",this.getKeys=function(){return n},this.isDown=function(e){for(var t in n)if(t==e)return!0;return!1}}var e=this;return t}),define("brejep/keypoll",function(){}),function(e){function t(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function n(e,t){if(typeof e!="function")throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}var r={VERSION:"0.7.4"};t.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.Signal=function(){this._bindings=[],this._prevParams=null},r.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,r,i){var s=this._indexOfListener(e,r);if(s!==-1){if(e=this._bindings[s],e.isOnce()!==n)throw Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else e=new t(this,e,n,r,i),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n=this._bindings.length,r;n--;)if(r=this._bindings[n],r._listener===e&&r.context===t)return n;return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return r!==-1&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(n){r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},typeof define=="function"&&define.amd?define("libs/signals",r):typeof module!="undefined"&&module.exports?module.exports=r:e.signals=r}(this),define("brejep/tickprovider",["libs/signals"],function(e){function t(){}var n=t.prototype;return n.previousTime=0,n.ticked=new e.Signal,n.request=null,n.start=function(){this.request=requestAnimationFrame(this.tick.bind(this))},n.stop=function(){cancelRequestAnimationFrame(this.request)},n.add=function(e,t){this.ticked.add(e,t)},n.remove=function(e,t){this.ticked.remove(e,t)},n.tick=function(e){e=e||Date.now();var t=this.previousTime||e;this.previousTime=e;var n=(e-t)*.001;this.ticked.dispatch(n),requestAnimationFrame(this.tick.bind(this))},t}),define("game/components/gamestate",[],function(){function e(e,t){this.lives=0,this.level=0,this.points=0,this.width=e,this.height=t}return e}),define("game/components/spaceship",[],function(){function e(){}return e}),define("game/components/position",["brejep/point"],function(e){function t(t,n,r,i){this.position=new e(t,n),this.rotation=r,this.collisionRadius=i}return t}),define("game/nodes/spaceshipcollision",["ash/node","game/components/spaceship","game/components/position"],function(e,t,n){function r(){Object.extend(r.prototype,e.prototype)}return r.prototype.spaceship=null,r.prototype.position=null,r.prototype.types={spaceship:t,position:n},r}),define("game/components/asteroid",[],function(){function e(){}return e}),define("game/nodes/asteroidcollision",["ash/node","game/components/asteroid","game/components/position"],function(e,t,n){function r(){Object.extend(r.prototype,e.prototype)}return r.prototype.asteroid=null,r.prototype.position=null,r.prototype.types={asteroid:t,position:n},r}),define("game/components/bullet",[],function(){function e(e){this.lifeRemaining=e}return e}),define("game/nodes/bulletcollision",["ash/node","game/components/bullet","game/components/position"],function(e,t,n){function r(){Object.extend(r.prototype,e.prototype)}return r.prototype.bullet=null,r.prototype.position=null,r.prototype.types={bullet:t,position:n},r}),define("game/systems/gamemanager",["ash/system","game/nodes/spaceshipcollision","game/nodes/asteroidcollision","game/nodes/bulletcollision","brejep/point"],function(e,t,n,r,i){function s(t,n){Object.extend(s.prototype,e.prototype),this.initialise(t,n)}var o=s.prototype;return o.gameState=null,o.creator=null,o.spaceships=null,o.asteroids=null,o.bullets=null,o.initialise=function(e,t){return this.gameState=e,this.creator=t,this},o.addToEngine=function(e){this.spaceships=e.getNodeList(t),this.asteroids=e.getNodeList(n),this.bullets=e.getNodeList(r)},o.update=function(e){if(this.spaceships.empty()&&this.gameState.lives>0){var t=new i(this.gameState.width*.5,this.gameState.height*.5),n=!0;for(var r=this.asteroids.head;r;r=r.next)if(r.position.position.distanceTo(t)<=r.position.collisionRadius+50){n=!1;break}n&&(this.creator.createSpaceship(),this.gameState.lives--)}if(this.asteroids.empty()&&this.bullets.empty()&&!this.spaceships.empty()){var s=this.spaceships.head;this.gameState.level++;var o=2+this.gameState.level;for(var u=0;u<o;++u){do var a=new i(Math.random()*this.gameState.width,Math.random()*this.gameState.height);while(a.distanceTo(s.position.position)<=80);this.creator.createAsteroid(30,a.x,a.y)}}},o.removeFromEngine=function(e){this.spaceships=null,this.asteroids=null,this.bullets=null},s}),define("game/components/motioncontrols",[],function(){function e(e,t,n,r,i){this.left=e,this.right=t,this.accelerate=n,this.accelerationRate=r,this.rotationRate=i}return e}),define("game/components/motion",["brejep/point"],function(e){function t(t,n,r,i){this.velocity=new e(t,n),this.angularVelocity=r,this.damping=i}return t}),define("game/nodes/motioncontrol",["ash/node","game/components/motioncontrols","game/components/position","game/components/motion"],function(e,t,n,r){function i(){Object.extend(i.prototype,e.prototype)}return i.prototype.control=null,i.prototype.position=null,i.prototype.motion=null,i.prototype.types={control:t,position:n,motion:r},i}),define("game/systems/motioncontrolsystem",["ash/system","game/nodes/motioncontrol"],function(e,t){function n(t){Object.extend(n.prototype,e.prototype),this.initialise(t)}var r=n.prototype;return r.keyPoll=null,r.nodeList=null,r.initialise=function(e){return this.keyPoll=e,this},r.addToEngine=function(e){this.nodeList=e.getNodeList(t)},r.removeFromEngine=function(e){this.nodeList=null},r.update=function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},r.updateNode=function(e,t){var n=e.control,r=e.position,i=e.motion;this.keyPoll.isDown(n.left)&&(r.rotation-=n.rotationRate*t),this.keyPoll.isDown(n.right)&&(r.rotation+=n.rotationRate*t),this.keyPoll.isDown(n.accelerate)&&(i.velocity.x+=Math.cos(r.rotation)*n.accelerationRate*t,i.velocity.y+=Math.sin(r.rotation)*n.accelerationRate*t)},n}),define("game/components/guncontrols",[],function(){function e(e){this.trigger=e}return e}),define("game/components/gun",["brejep/point"],function(e){function t(t,n,r,i){this.shooting=!1,this.offsetFromParent=null,this.timeSinceLastShot=0,this.offsetFromParent=new e(t,n),this.minimumShotInterval=r,this.bulletLifetime=i}return t}),define("game/nodes/guncontrol",["ash/node","game/components/guncontrols","game/components/gun","game/components/position"],function(e,t,n,r){function i(){Object.extend(i.prototype,e.prototype)}return i.prototype.control=null,i.prototype.gun=null,i.prototype.position=null,i.prototype.types={control:t,gun:n,position:r},i}),define("game/systems/guncontrolsystem",["ash/system","game/nodes/guncontrol"],function(e,t){function n(t,r){Object.extend(n.prototype,e.prototype),this.initialise(t,r)}var r=n.prototype;return r.keyPoll=null,r.creator=null,r.nodeList=null,r.initialise=function(e,t){return this.keyPoll=e,this.creator=t,this},r.addToEngine=function(e){this.nodeList=e.getNodeList(t)},r.removeFromEngine=function(e){this.nodeList=null},r.update=function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},r.updateNode=function(e,t){var n=e.control,r=e.position,i=e.gun;i.shooting=this.keyPoll.isDown(n.trigger),i.timeSinceLastShot+=t,i.shooting&&i.timeSinceLastShot>=i.minimumShotInterval&&(this.creator.createUserBullet(i,r),i.timeSinceLastShot=0)},n}),define("game/nodes/bulletage",["ash/node","game/components/bullet"],function(e,t){function n(){Object.extend(n.prototype,e.prototype)}return n.prototype.bullet=null,n.prototype.types={bullet:t},n}),define("game/systems/bulletagesystem",["ash/system","game/nodes/bulletage"],function(e,t){function n(t){Object.extend(n.prototype,e.prototype),this.initialise(t)}var r=n.prototype;return r.creator=null,r.nodeList=null,r.initialise=function(e){return this.creator=e,this},r.addToEngine=function(e){this.nodeList=e.getNodeList(t)},r.removeFromEngine=function(e){this.nodeList=null},r.update=function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},r.updateNode=function(e,t){var n=e.bullet;n.lifeRemaining-=t,n.lifeRemaining<=0&&this.creator.destroyEntity(e.entity)},n}),define("game/nodes/movement",["ash/node","game/components/position","game/components/motion"],function(e,t,n){function r(){Object.extend(r.prototype,e.prototype)}return r.prototype.position=null,r.prototype.motion=null,r.prototype.types={position:t,motion:n},r}),define("game/systems/movementsystem",["ash/system","game/nodes/movement"],function(e,t){function n(t){Object.extend(n.prototype,e.prototype),this.initialise(t)}var r=n.prototype;return r.gameState=null,r.nodeList=null,r.initialise=function(e){return this.gameState=e,this},r.addToEngine=function(e){this.nodeList=e.getNodeList(t)},r.removeFromEngine=function(e){this.nodeList=null},r.update=function(e){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,e)},r.doAFewTimes=!0,r.updateNode=function(e,t){var n=e.position,r=e.motion;n.position.x+=r.velocity.x*t,n.position.y+=r.velocity.y*t,n.position.x<0&&(n.position.x+=this.gameState.width),n.position.x>this.gameState.width&&(n.position.x-=this.gameState.width),n.position.y<0&&(n.position.y+=this.gameState.height),n.position.y>this.gameState.height&&(n.position.y-=this.gameState.height),n.rotation+=r.angularVelocity*t;if(r.damping>0){var i=Math.abs(Math.cos(n.rotation)*r.damping*t),s=Math.abs(Math.sin(n.rotation)*r.damping*t);r.velocity.x>i?r.velocity.x-=i:r.velocity.x<-i?r.velocity.x+=i:r.velocity.x=0,r.velocity.y>s?r.velocity.y-=s:r.velocity.y<-s?r.velocity.y+=s:r.velocity.y=0}},n}),define("game/systems/collisionsystem",["ash/system","game/nodes/spaceshipcollision","game/nodes/asteroidcollision","game/nodes/bulletcollision"],function(e,t,n,r){function i(t){Object.extend(i.prototype,e.prototype),this.initialise(t)}var s=i.prototype;return s.creator=null,s.spaceships=null,s.asteroids=null,s.bullets=null,s.initialise=function(e){return this.creator=e,this},s.addToEngine=function(e){this.spaceships=e.getNodeList(t),this.asteroids=e.getNodeList(n),this.bullets=e.getNodeList(r)},s.removeFromEngine=function(e){this.spaceships=null,this.asteroids=null,this.bullets=null},s.update=function(e){var t,n,r;for(t=this.bullets.head;t;t=t.next)for(n=this.asteroids.head;n;n=n.next)if(n.position.position.distanceTo(t.position.position)<=n.position.collisionRadius){this.creator.destroyEntity(t.entity),n.position.collisionRadius>10&&this.creator.createAsteroid(n.position.collisionRadius-10,n.position.position.x+Math.random()*10-5,n.position.position.y+Math.random()*10-5),this.creator.destroyEntity(n.entity);break}for(r=this.spaceships.head;r;r=r.next)for(n=this.asteroids.head;n;n=n.next)if(n.position.position.distanceTo(r.position.position)<=n.position.collisionRadius+r.position.collisionRadius){this.creator.destroyEntity(r.entity);break}},i}),define("game/components/display",[],function(){function e(e){this.graphic=e}return e}),define("game/nodes/render",["ash/node","game/components/position","game/components/display"],function(e,t,n){function r(){Object.extend(r.prototype,e.prototype)}return r.prototype.position=null,r.prototype.display=null,r.prototype.types={position:t,display:n},r}),define("game/systems/rendersystem",["ash/system","game/nodes/render"],function(e,t){function n(t){Object.extend(n.prototype,e.prototype),this.initialise(t)}var r=n.prototype;return r.context=null,r.nodes=null,r.initialise=function(e){return this.context=e,this},r.addToEngine=function(e){this.nodes=e.getNodeList(t);for(var n=this.nodes.head;n;n=n.next)this.addToDisplay(n);this.nodes.nodeAdded.add(this.addToDisplay,this),this.nodes.nodeRemoved.add(this.removeFromDisplay,this)},r.removeFromEngine=function(e){this.nodes=null},r.addToDisplay=function(e){},r.removeFromDisplay=function(e){},r.update=function(e){var t,n,r,i;this.context.save(),this.context.translate(0,0),this.context.rotate(0),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);for(t=this.nodes.head;t;t=t.next)r=t.display,i=r.graphic,n=t.position,i.x=n.position.x,i.y=n.position.y,i.rotation=n.rotation,i.draw();this.context.restore()},n}),define("game/systems/systempriorities",{preUpdate:1,update:2,move:3,resolveCollisions:4,render:5}),define("game/graphics/asteroidview",[],function(){function e(e,t){this.initialise(e,t)}var t=e.prototype;return t.x=0,t.y=0,t.width=0,t.height=0,t.rotation=0,t.graphic=null,t.radius=0,t.points=null,t.initialise=function(e,t){this.graphic=t,this.radius=e,this.width=e,this.height=e,this.points=[];var n=0;while(n<Math.PI*2){var r=(.75+Math.random()*.25)*this.radius,i=Math.cos(n)*r,s=Math.sin(n)*r;this.points.push({x:i,y:s}),n+=Math.random()*.5}return this.draw(),this},t.count=0,t.draw=function(){var e=this.graphic;e.save(),e.beginPath(),e.translate(this.x,this.y),e.rotate(this.rotation),e.fillStyle="#FFFFFF",e.moveTo(this.radius,0);for(var t=0;t<this.points.length;++t)e.lineTo(this.points[t].x,this.points[t].y);e.lineTo(this.radius,0),e.fill(),e.restore()},e}),define("game/graphics/spaceshipview",[],function(){function e(e){this.initialise(e)}var t=e.prototype;return t.x=0,t.y=0,t.width=20,t.height=20,t.rotation=0,t.graphic=null,t.initialise=function(e){return this.graphic=e,this.draw(),this},t.draw=function(){var e=this.graphic;e.save(),e.beginPath(),e.translate(this.x,this.y),e.rotate(this.rotation),e.fillStyle="#FFFFFF",e.moveTo(8,0),e.lineTo(-7,7),e.lineTo(-4,0),e.lineTo(-7,-7),e.lineTo(10,0),e.fill(),e.restore()},e}),define("game/graphics/bulletview",[],function(){function e(e){this.initialise(e)}var t=e.prototype;return t.x=0,t.y=0,t.width=4,t.height=4,t.rotation=0,t.graphic=null,t.initialise=function(e){return this.graphic=e,this.draw(),this},t.draw=function(){var e=this.graphic;e.save(),e.rotate(this.rotation),e.beginPath(),e.fillStyle="#FFFFFF",e.arc(this.x,this.y,2,0,Math.PI*2,!1),e.fill(),e.restore()},e}),define("game/entitycreator",["ash/entity","game/components/asteroid","game/components/spaceship","game/components/bullet","game/components/position","game/components/motion","game/components/motioncontrols","game/components/gun","game/components/guncontrols","game/components/display","game/graphics/asteroidview","game/graphics/spaceshipview","game/graphics/bulletview"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(e,t){this.initialise(e,t)}return p.prototype.game=null,p.prototype.graphics=null,p.prototype.initialise=function(e,t){return this.game=e,this.graphics=t,this},p.prototype.destroyEntity=function(e){this.game.removeEntity(e)},p.prototype.createAsteroid=function(n,r,o){var u=(new e).add(new t).add(new i(r,o,0,n)).add(new s((Math.random()-.5)*4*(50-n),(Math.random()-.5)*4*(50-n),Math.random()*2-1,0)).add(new f(new l(n,this.graphics)));return this.game.addEntity(u),u},p.prototype.createSpaceship=function(){var t=(new e).add(new n).add(new i(400,300,1,6)).add(new s(0,0,0,15)).add(new o(Keyboard.LEFT,Keyboard.RIGHT,Keyboard.UP,100,3)).add(new u(8,0,.3,2)).add(new a(Keyboard.Z)).add(new f(new c(this.graphics)));return this.game.addEntity(t),t},p.prototype.createUserBullet=function(t,n){var o=Math.cos(n.rotation),u=Math.sin(n.rotation),a=(new e).add(new r(t.bulletLifetime)).add(new i(o*t.offsetFromParent.x-u*t.offsetFromParent.y+n.position.x,u*t.offsetFromParent.x+o*t.offsetFromParent.y+n.position.y,0,0)).add(new s(o*150,u*150,0,0)).add(new f(new h(this.graphics)));return this.game.addEntity(a),a},p}),define("game/asteroids",["game/components/gamestate","game/systems/gamemanager","game/systems/motioncontrolsystem","game/systems/guncontrolsystem","game/systems/bulletagesystem","game/systems/movementsystem","game/systems/collisionsystem","game/systems/rendersystem","game/systems/systempriorities","game/entitycreator","ash/engine","ash/system","libs/signals","brejep/dictionary","brejep/tickprovider","brejep/keypoll"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){function m(){}var g=m.prototype;return g.width=0,g.height=0,g.engine=null,g.gameState=null,g.tickProvider=null,g.initialise=function(c){var h=c.getContext("2d");this.width=c.width,this.height=c.height,this.engine=new l,this.gameState=new e(this.width,this.height);var p=new v,m=new f(this.engine,h);this.engine.addSystem(new t(this.gameState,m),a.preUpdate),this.engine.addSystem(new n(p),a.update),this.engine.addSystem(new r(p,m),a.update),this.engine.addSystem(new i(m),a.update),this.engine.addSystem(new s(this.gameState),a.move),this.engine.addSystem(new o(m),a.resolveCollisions),this.engine.addSystem(new u(h),a.render),this.tickProvider=new d},g.start=function(){this.gameState.level=0,this.gameState.lives=3,this.gameState.points=0,this.tickProvider.add(this.engine.update,this.engine),this.tickProvider.start()},m}),define("asteroids-app",["brejep/fillsnfixes","game/asteroids"],function(e,t){function n(){function i(){var e=document.createElement("canvas");return e.setAttribute("id","game_stage"),e.setAttribute("width",n),e.setAttribute("height",r),e.style.backgroundColor="#000",e}var n=800,r=600;this.initialise=function(){e.initialise();var n=i();document.getElementById("game_wrapper").appendChild(n);var r=new t;r.initialise(n),r.start()}}return new n}),require(["require"],function(e){e(["libs/ash","brejep/keypoll","brejep/tickprovider","game/asteroids","game/entitycreator","game/systems/bulletagesystem","game/systems/collisionsystem","game/systems/gamemanager","game/systems/guncontrolsystem","game/systems/motioncontrolsystem","game/systems/movementsystem","game/systems/rendersystem","game/systems/systempriorities","game/nodes/asteroidcollision","game/nodes/bulletage","game/nodes/bulletcollision","game/nodes/guncontrol","game/nodes/motioncontrol","game/nodes/movement","game/nodes/render","game/nodes/spaceshipcollision","game/graphics/asteroidview","game/graphics/bulletview","game/graphics/spaceshipview","game/components/asteroid","game/components/bullet","game/components/display","game/components/gamestate","game/components/gun","game/components/guncontrols","game/components/motion","game/components/motioncontrols","game/components/position","game/components/spaceship","asteroids-app"])}),define("build/asteroids-build",function(){});